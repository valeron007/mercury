// This file was automatically generated from issuecomponents.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.Issue == 'undefined') { JIRA.Templates.Issue = {}; }


JIRA.Templates.Issue.watchersWithBrowse = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form action="#" method="post" class="aui recipients-form"><a href="#" class="cancel icon icon-close"></a><fieldset><label for="watchers-multi-select">', soy.$$escapeHtml("Add Watchers"), '</label><div class="autocomplete-user-target"><select id="watchers" name="watchers" data-description="', soy.$$escapeHtml("Start Typing for Users"), '" class="watchers-user-picker hidden" multiple="multiple">');
  var watcherList8 = opt_data.watchers;
  var watcherListLen8 = watcherList8.length;
  for (var watcherIndex8 = 0; watcherIndex8 < watcherListLen8; watcherIndex8++) {
    var watcherData8 = watcherList8[watcherIndex8];
    output.append('<option style="background-image:url(\'', soy.$$escapeHtml(watcherData8.avatarUrls['16x16']), '\')" selected="selected" value="', soy.$$escapeHtml(watcherData8.name), '">', soy.$$escapeHtml(watcherData8.displayName), '</option>');
  }
  output.append('</select></div></fieldset></form>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Issue.watchersNoBrowse = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form action="#" method="post" class="aui recipients-form"><a href="#" class="cancel icon icon-close"></a><fieldset><label for="watchers-multi-select">', soy.$$escapeHtml("Add Watchers"), '</label><div><input type="text" class="text" id="watchers-nosearch" /><div class="description">', soy.$$escapeHtml("Type username and press enter."), '</div></div><div class="recipients"><ol class="watchers">');
  var watcherList24 = opt_data.watchers;
  var watcherListLen24 = watcherList24.length;
  for (var watcherIndex24 = 0; watcherIndex24 < watcherListLen24; watcherIndex24++) {
    var watcherData24 = watcherList24[watcherIndex24];
    JIRA.Templates.Fields.recipientUsername({username: watcherData24.name, icon: watcherData24.avatarUrls['16x16'], displayName: watcherData24.displayName, escape: true}, output);
  }
  output.append('</ol></div></fieldset></form>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Issue.watchersReadOnly = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form class="aui recipients-form"><a href="#" class="cancel icon icon-close"></a><fieldset><div class="recipients"><ol class="watchers">');
  var watcherList34 = opt_data.watchers;
  var watcherListLen34 = watcherList34.length;
  for (var watcherIndex34 = 0; watcherIndex34 < watcherListLen34; watcherIndex34++) {
    var watcherData34 = watcherList34[watcherIndex34];
    JIRA.Templates.Fields.recipientUsername({username: watcherData34.name, icon: watcherData34.avatarUrls['16x16'], displayName: watcherData34.displayName, readOnly: true, escape: true}, output);
  }
  output.append('</ol></div></fieldset></form>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Issue.error = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<p>', soy.$$escapeHtml(opt_data.msg), '</p><ul>');
  var messageList47 = opt_data.errors;
  var messageListLen47 = messageList47.length;
  for (var messageIndex47 = 0; messageIndex47 < messageListLen47; messageIndex47++) {
    var messageData47 = messageList47[messageIndex47];
    output.append('<li>', soy.$$escapeHtml(messageData47), '</li>');
  }
  output.append('</ul>');
  return opt_sb ? '' : output.toString();
};

AJS.Shortener=AJS.Control.extend({_getDefaultOptions:function(){return{items:"a, span",numRows:1,shortenText:"hide",shortenOnInit:true,persist:true,expandButtonTooltip:"Click to view {0} more",collapseButtonTooltip:"Hide"}},init:function(options){if(typeof options==="string"){options={element:options}}options=options||{};this.options=AJS.$.extend(this._getDefaultOptions(),options);this._timerId=0;this.expanded=false;this.$container=AJS.$(this.options.element);this._assignEvents("body",document.body);this._ready()},_isValid:function(){return !this.initialized&&this.$container.is(":visible")&&this.$container.children().length>0},_ready:function(){if(this._isValid()){this.$items=this.$container.children(this.options.items);this.$expandButton=this._render("expandButton");this.$collapseButton=this._render("collapseButton");this._assignEvents("expand-button",".shortener-expand");this._assignEvents("collapse-button",".shortener-collapse");if(!jQuery.browser.msie||jQuery.browser.version>="9"){this._assignEvents("resize-region",window)}if(this._isCollapsedOnInit()){this.collapse()}else{this.expand()}this.initialized=true}},_renders:{"expandButton":function(){return AJS.$("<a href='#' class='ellipsis shortener-expand' title='"+this.options.expandButtonTooltip+"'></a><br>")},"collapseButton":function(){return AJS.$("<a title='Hide' class='icon icon-hide shortener-collapse' href='#'><span>"+this.options.collapseButtonTooltip+"</span></a>")}},_events:{"expand-button":{"click":function(event){if(event.currentTarget===this.$expandButton[0]){event.preventDefault();this.expand();this._saveState("expanded")}}},"collapse-button":{"click":function(event){if(event.currentTarget===this.$collapseButton[0]){event.preventDefault();this.collapse();this._saveState("collapsed");this.$container.scrollIntoView()}}},"resize-region":{"resize":function(){clearTimeout(this._timerId);if(!this.expanded){var instance=this;this._timerId=setTimeout(function(){instance.collapse()},400)}}},"body":{tabSelect:function(){this._ready()}}},_saveState:function(value){try{localStorage.setItem("AJS.Shortener#"+this.$container.closest("[id]").attr("id"),value)}catch(QUOTA_EXCEEDED_ERR){}},_loadState:function(){return localStorage.getItem("AJS.Shortener#"+this.$container.closest("[id]").attr("id"))},_isCollapsedOnInit:function(){var shortenOnInit=this._loadState();if(shortenOnInit!==null){return shortenOnInit!=="expanded"}return this.options.shortenOnInit},_removeButtons:function(){this.$expandButton.remove();this.$collapseButton.remove()},_getOverflowIndex:function(){if(this.$items.length>1){var currentRow=1;var prevItemPageX=-1;for(var i=0;i<this.$items.length;i++){var itemPageX=this.$items.eq(i).offset().left;if(itemPageX<=prevItemPageX){currentRow++;if(currentRow>this.options.numRows){return i}}prevItemPageX=itemPageX}}return -1},expand:function(){this._removeButtons();if(this._getOverflowIndex()>0){this.$collapseButton=this._render("collapseButton");this.$container.append(this.$collapseButton);this.$container.css("height","auto");if(jQuery.browser.msie&&jQuery.browser.version<"9"){AJS.$("body").toggleClass("reflow")}}this.expanded=true},collapse:function(){this._removeButtons();var i=this._getOverflowIndex();if(i>0){this.$container.css({"position":"absolute","visibility":"hidden","width":this.$container[0].clientWidth+"px"});var $expandButtonContent=this.$expandButton.first();do{var remainingItemCount=(this.$items.length-i);$expandButtonContent.text("("+remainingItemCount+")");this.$expandButton.insertBefore(this.$items[i]);i--;var oi=this.$items.eq(i).offset();var ob=this.$expandButton.offset();if(oi.left<ob.left&&ob.top<oi.top+10){break}}while(i>0);var height=(i<this.$items.length-1)?(this.$items.eq(i+1).offset().top-this.$container.offset().top)+"px":"auto";this.$container.css({"height":height,"position":"static","visibility":"visible","width":"auto"});$expandButtonContent.attr("title",AJS.format(this.options.expandButtonTooltip,remainingItemCount));if(jQuery.browser.msie&&jQuery.browser.version<"9"){AJS.$("body").toggleClass("reflow")}}else{this.$container.css("height","auto")}this.expanded=false}});jQuery.fn.shorten=function(options){var res=[];options=options||{};this.each(function(){options.element=this;res.push(new AJS.Shortener(options))});return res};
(function($,udf){var ns=".inputEvent ",dataBnd="bound.inputEvent",dataVal="value.inputEvent",dataDlg="delegated.inputEvent",bindTo=["input","textInput","propertychange","paste","cut","keydown","keyup","drop",""].join(ns),dlgtTo=["focusin","mouseover","dragstart",""].join(ns),supported={TEXTAREA:udf,INPUT:udf},delay={paste:udf,cut:udf,keydown:udf,drop:udf,textInput:udf};function isSupported(elem){return $(elem).attr("contenteditable")=="true"||elem.tagName in supported}$.event.special.txtinput={setup:function(data,namespaces,handler){var timer,bndCount,elem=this,$elem=$(this),triggered=false;if(isSupported(elem)){bndCount=$.data(elem,dataBnd)||0;if(!bndCount){$elem.bind(bindTo,handler)}$.data(elem,dataBnd,++bndCount);$.data(elem,dataVal,elem.value)}else{$elem.bind(dlgtTo,function(e){var target=e.target;if(isSupported(target)&&!$.data(elem,dataDlg)){bndCount=$.data(target,dataBnd)||0;if(!bndCount){$(target).bind(bindTo,handler)}$.data(elem,dataDlg,true);$.data(target,dataBnd,++bndCount);$.data(target,dataVal,target.value)}})}function handler(e){var elem=e.target;window.clearTimeout(timer),timer=null;if(triggered){return }if(e.type in delay&&!timer){timer=window.setTimeout(function(){if(elem.value!==$.data(elem,dataVal)){$(elem).trigger("txtinput");$.data(elem,dataVal,elem.value)}},0)}else{if(e.type=="propertychange"){if(e.originalEvent.propertyName=="value"){$(elem).trigger("txtinput");$.data(elem,dataVal,elem.value);triggered=true;window.setTimeout(function(){triggered=false},0)}}else{$(elem).trigger("txtinput");$.data(elem,dataVal,elem.value);triggered=true;window.setTimeout(function(){triggered=false},0)}}}},teardown:function(){var elem=$(this);elem.unbind(dlgtTo);elem.find("input, textarea").andSelf().each(function(){bndCount=$.data(this,dataBnd,($.data(this,dataBnd)||1)-1);if(!bndCount){elem.unbind(bindTo)}})}};$.fn.input=function(handler){return handler?$(this).bind("txtinput",handler):this.trigger("txtinput")}})(jQuery);
JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,$ctx){if($ctx.is(".js-stalker")){$ctx.stalker()}else{AJS.$(".js-stalker",$ctx).stalker()}});
JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,$ctx){AJS.$(".shorten",$ctx).shorten()});
AJS.$(function(){new JIRA.ToggleBlock({blockSelector:".toggle-wrap",triggerSelector:".mod-header h3",storageCollectionName:"block-states",});if(JIRA.Events.ISSUE_REFRESHED){JIRA.bind(JIRA.Events.ISSUE_REFRESHED,function(){if(JIRA.Events.REFRESH_TOGGLE_BLOCKS){JIRA.trigger(JIRA.Events.REFRESH_TOGGLE_BLOCKS)}})}});
(function($){function initGallery($el){var closeFancyBox=function(){$el.fancybox.close()};var isFireFoxLinux=function(){return $.os.linux&&$.browser.mozilla};var useOverlay=true;if(isFireFoxLinux()){useOverlay=false}var fancyBoxOptions={"imageScale":true,"centerOnScroll":false,"overlayShow":useOverlay,callbackOnStart:function(){$("#header").css("zIndex","-1");if(useOverlay){$("body").addClass("fancybox-show")}},"callbackOnShow":function(){$(document).click(function(){closeFancyBox()})},"onComplete":function(){var title=$("#fancybox-title");var mainWidth=$("#fancybox-title-main").outerWidth();var leftWidth=$("#fancybox-title-left").outerWidth();var rightWidth=$("#fancybox-title-right").outerWidth();title.width(mainWidth+leftWidth+rightWidth+5);var imageDivWidth=$("#fancybox-inner").width();title.css("marginLeft",-(title.width()/2)+(imageDivWidth/2));title.css("bottom",title.outerHeight(true)*-1)},"callbackOnClose":function(){$("#header").css("zIndex","");if(useOverlay){$("body").removeClass("fancybox-show")}$(document).unbind("click",closeFancyBox);if($.browser.safari){var top=$(window).scrollTop();$(window).scrollTop(10+5*(top==10)).scrollTop(top)}}};if($.browser.msie){fancyBoxOptions.transitionIn="none";fancyBoxOptions.transitionOut="none"}$el.fancybox(fancyBoxOptions)}function initWorkflow($ctx){$("a.issueaction-viewworkflow",$ctx).each(function(){var title=$(this).attr("rel");if(title){title=AJS.escapeHTML(title)}$(this).fancybox({type:"image",href:this.href,title:title,titlePosition:"outside",imageScale:true,centerOnScroll:true,overlayShadow:true})})}JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,$ctx,reason){initGallery($("a.gallery",$ctx));initWorkflow($ctx)});jQuery(function(){if(JIRA.Events.PANEL_REFRESHED){JIRA.bind(JIRA.Events.PANEL_REFRESHED,function(e,panel,$new,$existing){if(panel==="attachmentmodule"){initGallery($("a.gallery",$new))}else{if(panel==="details-module"){initWorkflow($new)}}})}})})(AJS.$);
(function($){var preventEscClosingComments=false;var commentForm={setCaretAtEndOfCommentField:function(){var $field=this.getField(),field=$field[0],length;if($field.length){length=$field.val().length;$field.scrollTop($field.attr("scrollHeight"));if(field.setSelectionRange&&length>0){field.setSelectionRange(length,length)}}},disable:function(){this.getForm().find("textarea").attr("readonly","readonly");this.getForm().find(":submit").attr("disabled","disabled")},isDirty:function(){var form=this.getForm();if(form){var field=this.getField()[0];return field.value!==field.defaultValue}return false},handleBrowseAway:function(){if(commentForm.isDirty()){return "You have entered a comment on this issue. If you navigate away from this page without first saving, the comment will be lost."}},setSubmitState:function(){if(jQuery.trim(this.getField().val()).length>0){this.getForm().find(":submit").removeAttr("disabled")}else{this.getForm().find(":submit").attr("disabled","disabled")}},enable:function(){this.getForm().find("textarea").removeAttr("readonly");this.getForm().find(":submit").removeAttr("disabled")},getCommentVisibility:function(){var visibility=$("#commentLevel :selected").val();if(visibility!==""){var split_v=visibility.split(":");return{"type":split_v[0],"value":$("#commentLevel :selected").text()}}return visibility},ajaxSubmit:function(callback){var $loading=jQuery('<span class="icon throbber loading"></span>');var issueId=JIRA.Issue.getIssueId();var issueKey=JIRA.Issue.getIssueKey();var restURL=contextPath+"/rest/api/2/issue/"+issueKey+"/comment";var newComment={"body":this.getField()[0].value};var visibility=this.getCommentVisibility();if(visibility!==""){newComment["visibility"]=visibility}$.ajax({url:restURL,type:"POST",contentType:"application/json",data:JSON.stringify(newComment),success:function(data){JIRA.trigger(JIRA.Events.UNLOCK_PANEL_REFRESHING,["addcommentmodule"]);JIRA.trigger(JIRA.Events.REFRESH_ISSUE_PAGE,[issueId,{complete:function(){var newCommentId="comment-"+data.id;window.location.hash=newCommentId;var $focusedTabs=$("#issue_actions_container > .issue-data-block.focused");$focusedTabs.removeClass("focused");var $newfocusedTab=$("#"+newCommentId);$newfocusedTab.addClass("focused");$loading.remove();commentDrawer.hide(true);footerComment.hide(true)}}])},error:function(xhr){function buildErrorDialog(errorMessage){var errorContent="<h2>"+"Error"+"</h2>"+'<div class="ajaxerror">'+'<div class="aui-message error">'+'<span class="aui-icon icon-warning"/>'+errorMessage+"</div>"+"</div>";return $(errorContent)}var response=$.parseJSON(xhr.responseText);var content;if(response&&response.errors&&response.errors.comment){content=buildErrorDialog(response.errors.comment)}else{content=JIRA.SmartAjax.buildDialogErrorContent(xhr)}new JIRA.FormDialog({content:content}).show();$loading.remove();commentForm.enable()}});$loading.appendTo(this.getForm().find(":submit").parent())},getForm:function(){var $form=$("form#issue-comment-add");if($form.length===1){this.$form=$form}return this.$form},getField:function(){var $form=this.getForm();return this.getForm().find("#comment")},hide:function(cancel){this.getForm().detach();if(JIRA.Events.UNLOCK_PANEL_REFRESHING){JIRA.trigger(JIRA.Events.UNLOCK_PANEL_REFRESHING,["addcommentmodule"])}if(cancel){this.cancel()}},show:function(){this.focus();if(JIRA.Events.LOCK_PANEL_REFRESHING){JIRA.trigger(JIRA.Events.LOCK_PANEL_REFRESHING,["addcommentmodule"])}},focus:function(){this.getField().focus().trigger("keyup");this.setCaretAtEndOfCommentField()},showNoCommentMsg:function(e){if(this.getField().val()===""){$("#emptyCommentErrMsg").show();return true}},cancel:function(){var instance=this;setTimeout(function(){instance.getField().val("")},100);$("#comment-preview_link.selected").click()}};var footerComment={getModule:function(){return $("#addcomment")},isActive:function(){return this.getModule().hasClass("active")},hide:function(cancel){if(this.isActive()){this.getModule().removeClass("active");commentForm.hide(cancel)}},ajaxSubmit:function(){commentForm.ajaxSubmit(function(){footerComment.hide()})},show:function(){if(!this.isActive()){commentDrawer.hide();this.getModule().addClass("active");this.appendForm();commentForm.show()}},appendForm:function(){this.getModule().find(".mod-content").append(commentForm.getForm())}};var commentDrawer={getTrigger:function(){return $("#comment-issue")},appendForm:function(){$(".ops-cont").append(commentForm.getForm())},ajaxSubmit:function(){commentForm.ajaxSubmit(function(){commentDrawer.hide()})},isActive:function(){return this.getTrigger().hasClass("active")},hide:function(cancel){if(this.isActive()){this.getTrigger().removeClass("active");commentForm.hide(cancel);JIRA.Issue.getStalker().removeClass("action").trigger("stalkerHeightUpdated")}},show:function(){if(!this.isActive()){footerComment.hide();this.getTrigger().addClass("active");this.appendForm();commentForm.show();JIRA.Issue.getStalker().addClass("action").trigger("stalkerHeightUpdated")}},toggle:function(){if(this.isActive()){this.hide()}else{this.show()}}};var oldBeforeUnload=window.onbeforeunload;$(document).delegate("body:not(.ka) #issue-comment-add","submit",function(e){window.onbeforeunload=oldBeforeUnload}).delegate(".ka .issue-header #issue-comment-add","submit",function(e){commentDrawer.ajaxSubmit();e.preventDefault()}).delegate(".ka #addcomment #issue-comment-add","submit",function(e){footerComment.ajaxSubmit();e.preventDefault()}).delegate(".issue-header #comment-issue","click",function(e){commentDrawer.toggle();e.preventDefault()}).delegate("#issue-comment-add .cancel","click",function(e){e.preventDefault();commentDrawer.hide(true)}).delegate("#footer-comment-button","click",function(e){footerComment.show();e.preventDefault()}).delegate("#addcomment .cancel","click",function(e){e.preventDefault();footerComment.hide(true)}).delegate("#issue-comment-add","submit",function(){window.setTimeout(function(){commentForm.disable()},0)}).delegate("#issue-comment-add #comment","txtinput",function(){commentForm.setSubmitState()}).delegate("#issue-comment-add input[type='submit']","click",function(e){if(commentForm.showNoCommentMsg()){e.preventDefault()}}).bind("showWikiInput",function(){var $commentField=commentForm.getField();if($commentField.is(":visible:enabled")){JIRA.Issue.getStalker().trigger("stalkerHeightUpdated");if($commentField.length>0){$commentField.focus()}}}).bind("showWikiInput",function(){commentForm.setCaretAtEndOfCommentField()}).bind("showWikiPreview",function(){JIRA.Issue.getStalker().trigger("stalkerHeightUpdated")}).bind("keydown",function(e){if(e.keyCode===$.ui.keyCode.ESCAPE&&AJS.InlineLayer.current){preventEscClosingComments=true;$(document).one("Mention.afterHide",function(e){preventEscClosingComments=false})}if(e.keyCode===$.ui.keyCode.ESCAPE&&!AJS.InlineLayer.current&&!preventEscClosingComments){commentDrawer.hide()}});window.onbeforeunload=function(){return oldBeforeUnload.apply(this,arguments)||commentForm.handleBrowseAway.apply(this,arguments)};$(function(){new AJS.SecurityLevelSelect($("#commentLevel"))})})(AJS.$);AJS.$(function(){if(parseUri(window.location.href).anchor==="add-comment"){AJS.$("#footer-comment-button").click()}});
(function($){var activateTab=function(tabNum){$("#customfield-tabs li.active").removeClass("active");$("#tabCell"+tabNum).addClass("active");$("#customfieldmodule ul.property-list:not(hidden)").addClass("hidden");var $tabPane=$("#tabCellPane"+tabNum);$tabPane.removeClass("hidden").trigger("tabSelect",{pane:$tabPane})};$(document).delegate("#customfield-tabs li a","click",function(e){e.preventDefault();var $this=AJS.$(this);activateTab($this.attr("rel"))});$(function(){var revealer=function(e){var $containingTab=$(e.target).closest(".pl-tab");if($containingTab.length>0){activateTab($containingTab.attr("id").substring("tabCellPane".length))}};if(JIRA.Events.PANEL_REFRESHED){JIRA.bind(JIRA.Events.PANEL_REFRESHED,function(e,panel,$new,$existing){if(panel==="details-module"){var $activeTab=$existing.find("#customfield-tabs li.active");if($activeTab.length===1){$new.find("#"+$activeTab.attr("id")+" a").click()}}$("#customfieldmodule").unbind("reveal");$("#customfieldmodule").bind("reveal",revealer)})}$("#customfieldmodule").bind("reveal",revealer)})})(AJS.$);
(function($){$(document).delegate("#tt_include_subtasks input","click",function(e){if(AJS.$(this).is(":checked")){AJS.$("#tt_info_single").hide();AJS.$("#tt_info_aggregate").show()}else{AJS.$("#tt_info_aggregate").hide();AJS.$("#tt_info_single").show()}})})(AJS.$);
AJS.$(function(){var WatcherModel=Backbone.Model.extend({url:[AJS.contextPath(),"rest/api/2/issue",AJS.Meta.get("issue-key"),"watchers"].join("/"),initialize:function(){this.set("canBrowseUsers",AJS.Meta.get("can-search-users"));this.set("isReadOnly",!AJS.Meta.get("can-edit-watchers"))},_parseResponse:function(responseText){try{return JSON.parse(responseText)}catch(e){this._showFatalErrorMessage();return null}},_showFatalErrorMessage:function(){var msg="<p>"+"Communications Breakdown"+"</p>"+"<p>"+"Close this dialog and press refresh in your browser"+"</p>";JIRA.Messages.showErrorMsg(msg,{closeable:true})},getUser:function(username){return AJS.$.ajax({url:AJS.contextPath()+"/rest/api/2/user?username="+username,error:_.bind(function(xhr){if(xhr.status!==404){this.handleErrorResponse(xhr,"There was an error adding watcher")}},this)})},handleErrorResponse:function(xhr,msg){var errorCollection=this._parseResponse(xhr.responseText);if(errorCollection.errorMessages){var html=JIRA.Templates.Issue.error({msg:msg,errors:errorCollection.errorMessages});JIRA.Messages.showErrorMsg(html,{closeable:true})}this.trigger("errorOccurred")},addWatcher:function(username){return AJS.$.ajax({type:"post",url:this.url,global:false,data:JSON.stringify(username),contentType:"application/json",error:_.bind(function(xhr){this.handleErrorResponse(xhr,"There was an error adding watcher")},this)})},removeWatcher:function(username){return AJS.$.ajax({type:"delete",global:false,url:this.url+"?username="+username,error:_.bind(function(xhr){this.handleErrorResponse(xhr,"There was an error removing watcher")},this)})}});var AbstractWatchersView=Backbone.View.extend({initialize:function(){_.bindAll(this)},renderNoWatchers:function(){if(this.$(".recipients li").length===0){var $empty=AJS.$("<div class='aui-message info watchers-empty' />").html("<span class='aui-icon icon-info' /> "+"There are no watchers.");this.$("fieldset").append($empty)}else{this.$(".watchers-empty").remove()}},render:function(){var deferred=jQuery.Deferred();this.model.fetch().done(_.bind(function(){this._render();this.renderNoWatchers();deferred.resolve(this.$el);window.setTimeout(_.bind(function(){this.focus()},this),0)},this));return deferred.promise()},watch:function(){AJS.$("#watchers-val .action-text").text("Watching")},unwatch:function(){AJS.$("#watchers-val .action-text").text("Watch")},focus:AJS.$.noop,_incrementWatcherCount:function(){var $el=AJS.$("#watcher-data");var currentCount=parseInt($el.text(),10);$el.text(currentCount+1);this.renderNoWatchers()},_decrementWatcherCount:function(){var $el=AJS.$("#watcher-data");var currentCount=parseInt($el.text(),10);$el.text(currentCount-1);this.renderNoWatchers()}});var WatchersView=AbstractWatchersView.extend({events:{selected:"addWatcherToModel",unselect:"removeWatcherFromModel"},_render:function(){this.$el.html(JIRA.Templates.Issue.watchersWithBrowse(this.model.toJSON()));var picker=new JIRA.MultiUserListPicker({element:this.$el.find(".watchers-user-picker"),width:220})},focus:function(){this.$el.find("#watchers-textarea").focus()},addWatcherToModel:function(e,descriptor){e.preventDefault();this.model.addWatcher(descriptor.value()).done(_.bind(function(){this._incrementWatcherCount();if(descriptor.value()===AJS.Meta.get("remote-user")){this.watch()}},this))},removeWatcherFromModel:function(e,descriptor){this.model.removeWatcher(descriptor.value()).done(_.bind(function(){this._decrementWatcherCount();if(descriptor.value()===AJS.Meta.get("remote-user")){this.unwatch();JIRA.trace("jira.issue.watcher.deleted")}},this))}});var WatchersNoBrowseView=AbstractWatchersView.extend({events:{"click .remove-recipient":"removeWatcher","submit":"addWatcher"},addWatcher:function(e){e.preventDefault();this.removeInlineError();var $field=AJS.$("#watchers-nosearch");var username=AJS.$.trim(AJS.$("#watchers-nosearch").val());$field.attr("disabled","disabled");if(this.hasUsername(username)){$field.removeAttr("disabled");this.showInlineError(AJS.format("User {0} is already watching this issue",username));$field.val("")}else{this.model.getUser(username).done(_.bind(function(data){var html=JIRA.Templates.Fields.recipientUsername({icon:data.avatarUrls["16x16"],username:data.name,displayName:data.displayName});if(username===AJS.Meta.get("remote-user")){this.watch()}$field.val("");this.$(".watchers").append(html);this.model.addWatcher(data.name);this._incrementWatcherCount()},this)).fail(_.bind(function(xhr){if(xhr.status===404){this.showInlineError("User does not exist")}},this)).always(function(){$field.removeAttr("disabled").focus()})}},hasUsername:function(username){var result=false;this.$(".watchers li").each(function(){if(AJS.$(this).attr("data-username")===username){result=true;return false}});return result},removeInlineError:function(){this.$(".error").remove()},showInlineError:function(msg){AJS.$("<div />").addClass("error").text(msg).insertAfter(this.$(".description"))},focus:function(){AJS.$("#watchers-nosearch").focus()},removeWatcher:function(e){e.preventDefault();var $item=AJS.$(e.target).closest("li");var username=$item.attr("data-username");if(username){$item.remove();this.model.removeWatcher(username);this._decrementWatcherCount();if(username===AJS.Meta.get("remote-user")){this.unwatch()}}JIRA.trace("jira.issue.watcher.deleted")},_render:function(){this.$el.html(JIRA.Templates.Issue.watchersNoBrowse(this.model.toJSON()))}});var WatchersReadOnly=AbstractWatchersView.extend({_render:function(){this.$el.html(JIRA.Templates.Issue.watchersReadOnly(this.model.toJSON()))}});function getView(model){if(model.get("isReadOnly")){return WatchersReadOnly}else{if(model.get("canBrowseUsers")){return WatchersView}else{return WatchersNoBrowseView}}}var dialog=AJS.InlineDialog("#view-watcher-list","watchers",function(contents,trigger,doShowPopup){AJS.$("#watchers-val .icon:first").addClass("loading");var model=new WatcherModel();var view=getView(model);new view({model:model}).render().done(function(viewHtml){contents.html(viewHtml);contents.find(".cancel").click(function(e){dialog.hide();e.preventDefault()});AJS.$("#watchers-val .icon:first").removeClass("loading");doShowPopup()});model.on("errorOccurred",function(){dialog.hide()})},{width:240,useLiveEvents:true,items:"#view-watcher-list",preHideCallback:function(){return !AJS.InlineLayer.current}});AJS.$(document).bind("keydown",function(e){if(e.keyCode===27&&AJS.InlineDialog.current!=dialog&&dialog.is(":visible")){if(AJS.InlineDialog.current){AJS.InlineDialog.current.hide()}dialog.hide()}});AJS.$(document).bind("showLayer",function(e,type,hash){if(type&&type==="inlineDialog"&&hash&&hash.id&&hash.id==="watchers"){AJS.$("body").unbind("click.watchers.inline-dialog-check")}})});
JIRA.ViewIssueTabs=(function(){var AJAX_LOAD_CLASS="ajax-activity-content";var AJAX_LINK_SELECTOR=AJS.format("a.{0}",AJAX_LOAD_CLASS);var issueTabLoadedListeners=[];var $tabContents,$tabProgress;var xhrInProgress;function dispatchIssueTabLoadedEvent(container){container=container||document;AJS.$.each(issueTabLoadedListeners,function(i,fn){fn(container)})}function bindToTabDivs(container){$tabContents=AJS.$(container).find("#issue_actions_container");$tabProgress=AJS.$(container).find("div.issuePanelProgress")}function dispatchIssueTabErrorEvent(smartAjaxResult,activeTabKey){var errorPopup=new JIRA.FormDialog({id:"issue-tab-error-dialog",widthClass:"small",content:JIRA.SmartAjax.buildDialogErrorContent(smartAjaxResult,false)});setActiveTab(activeTabKey);$tabContents.show();errorPopup.show()}function setActiveTab(activeTabKey){AJS.$("#issue-tabs li").each(function(){var $li=AJS.$(this);var tabKey=$li.data("key");var labelHtml=AJS.format("<strong>{0}</strong>",$li.data("label"));if(tabKey==activeTabKey){$li.addClass("active");$li.html(labelHtml)}else{$li.removeClass("active");var id=$li.data("id");var href=$li.data("href");$li.html(AJS.format('<a id="{0}" href="{1}" class="{2}">{3}</a>',id,href,AJAX_LOAD_CLASS,labelHtml))}});enablePjaxOnLinks(AJS.$("#issue-tabs"))}function putTabInLoadingState(activeTabKey){$tabContents.hide();setActiveTab(activeTabKey)}function enablePjaxOnLinks(context){var activeTabKey=AJS.$(context).find("li.active").data("key");AJS.$(context).find(AJAX_LINK_SELECTOR).click(function(event){if(event.metaKey){return }event.preventDefault();if(xhrInProgress){xhrInProgress.abort()}var $a=AJS.$(this);var containerID="#activitymodule div.mod-content";var loadingTabKey=$a.parent().data("key");putTabInLoadingState(loadingTabKey);var xhr=JIRA.SmartAjax.makeRequest({jqueryAjaxFn:AJS.$.pjax,container:containerID,url:$a.attr("href"),timeout:null,complete:function(xhr,status,smartAjaxResult){if(status!="abort"){xhrInProgress=null;if(!smartAjaxResult.successful){if(smartAjaxResult.status<300||smartAjaxResult.status>=400){dispatchIssueTabErrorEvent(smartAjaxResult,activeTabKey)}return }dispatchIssueTabLoadedEvent(AJS.$(containerID))}}});jQuery(xhr).throbber({target:$tabProgress});xhrInProgress=xhr})}function appendHashCodeToLinks(context){AJS.$(context).find(AJAX_LINK_SELECTOR).each(function(){var $a=AJS.$(this);$a.attr("href",$a.attr("href")+"#issue-tabs")})}function processActivityModuleLinks(context){if(AJS.$.support.pjax){enablePjaxOnLinks(context)}else{appendHashCodeToLinks(context)}}function setupMouseoverBehaviour(context){if(jQuery.browser.msie&&parseInt(jQuery.browser.version,10)===7){jQuery("a.twixi",context).bind("focus",function(e){e.preventDefault()})}else{jQuery(context).bind("moveToFinished",function(event,target){jQuery("a.twixi:visible",target).focus()})}}function onTabReady(listener){if(jQuery.inArray(listener,issueTabLoadedListeners)<0){issueTabLoadedListeners.push(listener)}}onTabReady(bindToTabDivs);onTabReady(processActivityModuleLinks);onTabReady(setupMouseoverBehaviour);onTabReady(JIRA.userhover);return{onTabReady:onTabReady,domReady:dispatchIssueTabLoadedEvent}})();AJS.$(function(){if(JIRA.Events.PANEL_REFRESHED){JIRA.bind(JIRA.Events.PANEL_REFRESHED,function(e,panel,$new,$existing){if(panel==="activitymodule"){var $focusedTab=$existing.find("#issue_actions_container > .issue-data-block.focused");if($focusedTab.length===1){$new.find("#"+$focusedTab.attr("id")).addClass("focused")}}})}});JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(event,$el){JIRA.ViewIssueTabs.domReady($el)});
